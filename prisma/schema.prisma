// 1. Prisma Clientë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì„¤ì •
generator client {
  provider = "prisma-client-js"
}

// 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • (PostgreSQL)
datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

//ìœ ì € ëª¨ë¸
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String // ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸
  nickname  String   @unique
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  posts    Post[]
  comments Comment[]
}

// 3. ê²Œì‹œê¸€ ëª¨ë¸ (ì„¤ê³„ë„)
model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String   @db.Text
  nickname  String
  password  String
  view      Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ğŸ”¥ ì¶”ê°€: ì—­ì •ê·œí™”ë¥¼ ìœ„í•œ ëŒ“ê¸€ ì¹´ìš´íŠ¸ ì»¬ëŸ¼
  commentCount Int @default(0)

  // ì¶”ê°€: ì´ ê²Œì‹œê¸€ì— ë‹¬ë¦° ëŒ“ê¸€ë“¤ (1:N ê´€ê³„)
  comments Comment[]
  images   Image[] // ğŸ”¥ ì¶”ê°€: ê²Œì‹œê¸€ì— í¬í•¨ëœ ì´ë¯¸ì§€ë“¤
  hasImage Boolean   @default(false) // ê²Œì‹œê¸€ì— ì´ë¯¸ì§€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ í™•ì¸
  // [ì¶”ê°€] íšŒì›ê³¼ ì—°ê²° (ì„ íƒì‚¬í•­ ? ë¥¼ ë¶™ì—¬ì„œ ìµëª…ê¸€ì¼ ë• ë¹„ì›Œë‘ )
  authorId Int?
  author   User?     @relation(fields: [authorId], references: [id])
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  nickname  String
  password  String
  createdAt DateTime @default(now())

  isDeleted Boolean   @default(false) // ì‚­ì œ ì—¬ë¶€ ìƒíƒœê°’
  deletedAt DateTime? // ì‚­ì œëœ ì‹œì  (ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ ê´€ë¦¬ìš©ìœ¼ë¡œ ì¢‹ìŒ)

  // ì¶”ê°€: ì–´ëŠ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ì¸ì§€ ì—°ê²°
  postId Int
  post   Post  @relation(fields: [postId], references: [id], onDelete: Cascade)
  user   User? @relation(fields: [userId], references: [id])
  userId Int?
}

model Image {
  id        Int      @id @default(autoincrement())
  url       String // ì´ë¯¸ì§€ ì ‘ê·¼ ì£¼ì†Œ (ì˜ˆ: /uploads/abc.jpg)
  filename  String // ì €ì¥ëœ íŒŒì¼ëª… (ì„œë²„ ê´€ë¦¬ìš©)
  createdAt DateTime @default(now())

  // ì–´ëŠ ê²Œì‹œê¸€ì— í¬í•¨ëœ ì´ë¯¸ì§€ì¸ì§€ ì—°ê²°
  postId Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
}
